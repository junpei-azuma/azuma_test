---
apployTo: "**/*.java"
---

# Javaのコーディングガイドライン

全てのコードに[copilot-instructions.md](../copilot-instructions.md)の内容を適用する。

## 基本
- Javaのバージョンは、LTS（Long Term Support）バージョンを使用する。2025年6月現在はJava 21がLTS。
- プロジェクトのビルドツールはGradleを使用する。
- ファイルのエンコーディングはUTF-8を使用する。

## 命名規則
- クラス名はCamelCaseを使用する。ただし、頭文字は大文字にする（例: `UserService`）。
- 変数・関数・メソッド名はCamelCaseを使用する（例: `getUserName`）。
- 定数は全て大文字で、単語間はアンダースコアで区切る（例: `MAX_USERS`）。
- パッケージ名は小文字で、単語間はドットで区切る（例: `com.example.project`）。
- クラスやメソッドの名前は、機能や役割を明確に表現するようにする（例: `calculateTotalPrice`）。
- 変数名は、意味が明確で短く、かつ一貫性を持たせる（例: `userCount`ではなく`numberOfUsers`）。

## 実装
- 変数やプロパティはイミュータブルにする。
- メソッドは、可能な限り小さく、単一の責任を持つようにする。
- コメントは、コードの意図や複雑なロジックを説明するために使用する。ただし、明らかなコードの意図を説明するコメントは避ける（例: `// ユーザー名を取得する`は不要）。
- メソッドやクラスのドキュメンテーションコメント（Javadoc）を使用して、APIの使用方法や意図を明確にする。
- コードの重複を避けるために、共通のロジックはメソッドやクラスに抽出する。
- 適切にエラーハンドリングやnullチェックを行う。Optionalを使用してnullを避けることも検討する。

### レイヤー毎の実装

- presentation層
  - Controllerクラス
    - リクエストを受け取り、サービスクラスに処理を委譲する。
    - リクエストはFormクラスで受け取る。サービスクラスに渡す際にはFormクラスをRequestオブジェクトに変換する。
  - Formクラス
    - 画面からの入力を受け取る。
    - 入力値と同じ名前のプロパティを持つ。
    - 入力値のバリデーションを必要に応じて行う。
    - サービスクラスに渡す際には、Requestオブジェクトに変換する。

## テスト
- ユニットテストは必ず書く。ユニットテストを書けない場合は「書けない」と伝えてレビューを受ける。
- 例外
  - Spring Bootの自動設定や、外部ライブラリの機能を使用する場合は、ユニットテストを書かないことを許容する。但し、その場合レビューを受けること。
- 内部実装ではなく、外部からの振る舞いをテストすることを重視する。
- テストは、テスト対象のクラスと同じパッケージに配置する。
- テストで利用するライブラリ. 他にも必要に応じて追加する。
  - JUnit
  - Mockito
  - MockMvc
- Controllerクラスのテストは、SpringのMockMvcを使用して行う。
- サービスクラスのテストは、Mockitoを使用して依存関係をモックする。


## 依存ライブラリ
> [!NOTE]
> 本リポジトリは依存ライブラリを最小限に抑える。
> 
>   * 理由: 依存ライブラリが多いと、セキュリティリスクやメンテナンスの負担が増大するため。
> 
> 信頼性を考慮してサードパーティのライブラリは原則として使用しない。
- プロジェクトの`build.gradle`に明示的に定義する。
- Javaの標準ライブラリやSpring Frameworkのライブラリを優先的に使用する。サードパーティのライブラリは原則として使用しない。どうしても使う場合はコミット前に必ずレビューを受ける。
- 不要なライブラリは使用しない。Javaの標準機能で実現できる場合は、標準機能を使用する。